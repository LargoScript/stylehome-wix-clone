name: Deploy to GitHub Pages (DISABLED - using gh-pages branch instead)

on:
  workflow_dispatch:  # Only manual trigger, main workflow is deploy-gh-pages-branch.yml

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build
        run: npm run build
      
      - name: Verify build output
        run: |
          echo "=== Build Verification ==="
          echo "Checking dist/index.html..."
          if [ -f dist/index.html ]; then
            head -20 dist/index.html
          else
            echo "ERROR: dist/index.html not found!"
            exit 1
          fi
          echo ""
          echo "Checking for CSS/JS files..."
          if ls dist/assets/*.css 1> /dev/null 2>&1; then
            echo "CSS files found:"
            ls -lh dist/assets/*.css
          else
            echo "WARNING: No CSS files found"
          fi
          if ls dist/assets/*.js 1> /dev/null 2>&1; then
            echo "JS files found:"
            ls -lh dist/assets/*.js
          else
            echo "WARNING: No JS files found"
          fi
          echo ""
          echo "Checking .nojekyll file..."
          if [ -f dist/.nojekyll ]; then
            echo "✓ .nojekyll file exists"
          else
            echo "Creating .nojekyll file..."
            touch dist/.nojekyll
          fi
          echo ""
          echo "Verifying CSS paths in HTML..."
          if grep -q '/stylehome-wix-clone/assets/.*\.css' dist/index.html; then
            echo "✓ CSS paths look correct"
            grep -o '/stylehome-wix-clone/assets/[^"]*\.css' dist/index.html | head -5
          else
            echo "WARNING: CSS paths may be incorrect"
            grep -i '\.css' dist/index.html | head -5
          fi
          echo ""
          echo "Listing dist directory structure..."
          find dist -type f -name "*.html" | head -10
          echo ""
          echo "Total files in dist:"
          find dist -type f | wc -l
      
      - name: Setup Pages
        uses: actions/configure-pages@v4
      
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: './dist'

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
